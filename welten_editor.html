<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Weltensymbol Editor</title>
  <link rel="stylesheet" href="common.css">
  <script src="worldData.js"></script>
  <script src="common.js"></script>
</head>
<body>
  <div id="editorContainer">
    <h1>Weltensymbol Editor</h1>
    <div id="worldButtons"></div>
    <div id="playerTargetInfo"></div>
    <div id="symbolPalette"></div>
    <h2>Ausgabefeld</h2>
    <div id="output"></div>
    <br>
    <button id="clearGrid">Grid leeren</button>
    <button id="generateAltText">ALT Text generieren</button>
    <button id="transferToGame">In Spiel Ã¼bernehmen</button>
  </div>
  <script>
    const gridCols = 30, gridRows = 10;
    let gridData = [];
    let selectedSymbol = "";
    let lastWorldType = "galaxy";
    
    function populateWorldButtons() {
      const container = document.getElementById("worldButtons");
      container.innerHTML = "";
      for (let world in worldData) {
        const btn = document.createElement("button");
        btn.innerText = world;
        btn.addEventListener("click", () => {
          lastWorldType = world;
          highlightWorldButton(world);
          updatePlayerTargetInfo();
          populateSymbolPalette();
        });
        container.appendChild(btn);
      }
    }
    
    function highlightWorldButton(selectedWorld) {
      const buttons = document.querySelectorAll("#worldButtons button");
      buttons.forEach(btn => {
        btn.style.backgroundColor = (btn.innerText === selectedWorld) ? "#555" : "#333";
      });
    }
    
    function updatePlayerTargetInfo() {
      const infoDiv = document.getElementById("playerTargetInfo");
      const currentWorld = worldData[lastWorldType];
      infoDiv.innerHTML =
        "Spielersymbol: <span style='color: limegreen;'>" + currentWorld.player + "</span>" +
        " | Zielsymbol: <span style='color: red;'>" + currentWorld.target + "</span>";
    }
    
    function populateSymbolPalette() {
      const palette = document.getElementById("symbolPalette");
      palette.innerHTML = "";
      const currentWorld = worldData[lastWorldType];
      const symbols = currentWorld.symbols.concat(currentWorld.rare, currentWorld.bottom);
      symbols.forEach(sym => {
        const span = document.createElement("span");
        span.classList.add("symbol");
        span.textContent = sym;
        if (sym === currentWorld.player) span.classList.add("playerSymbol");
        if (sym === currentWorld.target) span.classList.add("targetSymbol");
        span.addEventListener("click", () => {
          document.querySelectorAll(".symbol").forEach(el => el.classList.remove("selected"));
          span.classList.add("selected");
          selectedSymbol = sym;
        });
        palette.appendChild(span);
      });
    }
    
    function initEditor() {
      gridData = initGrid(gridRows, gridCols);
    }
    
    function renderEditor() {
      renderGameGrid(gridData, gridCols, gridRows);
    }
    
    document.getElementById("clearGrid").addEventListener("click", () => {
      clearGrid();
    });
    
    document.getElementById("generateAltText").addEventListener("click", () => {
      const currentWorld = worldData[lastWorldType];
      const altText = "Alternativtext: Dieses Bild zeigt eine " + (currentWorld.description || lastWorldType) +
        " Welt, erstellt mit dem Weltensymbol Editor. Das Raster umfasst " + gridRows + " Zeilen und " + gridCols + " Spalten.";
      navigator.clipboard.writeText(altText).then(() => alert("ALT Text kopiert!"));
    });
    
    document.getElementById("transferToGame").addEventListener("click", () => {
      const currentWorld = worldData[lastWorldType];
      const currentGame = { player: currentWorld.player, target: currentWorld.target };
      if (!gridData.flat().includes(currentGame.player)) {
        alert("Fehler: Das Spielersymbol (" + currentGame.player + ") fehlt.");
        return;
      }
      if (!gridData.flat().includes(currentGame.target)) {
        alert("Fehler: Das Zielsymbol (" + currentGame.target + ") fehlt.");
        return;
      }
      window.location.href = transferToPage("Weltengenerator_Mit_Spiel.html", lastWorldType, gridData);
    });
    
    window.addEventListener("load", () => {
      populateWorldButtons();
      highlightWorldButton(lastWorldType);
      updatePlayerTargetInfo();
      populateSymbolPalette();
      initEditor();
      // Falls Parameter vorhanden, loadGameFromParams() aufrufen.
      // Andernfalls beginnt das Editor-Raster als leer.
      // loadGameFromParams();
    });
  </script>
</body>
</html>
