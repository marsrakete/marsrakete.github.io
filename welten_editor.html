<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Weltensymbol Editor</title>
  <style>
    body {
      background: #121212;
      color: white;
      font-family: monospace;
      padding: 20px;
      text-align: center;
    }
    #editorContainer {
      max-width: 800px;
      margin: auto;
    }
    select {
      font-size: 1em;
      padding: 5px;
    }
    #symbolPalette {
      margin-top: 20px;
    }
    .symbol {
      display: inline-block;
      padding: 5px;
      border: 1px solid white;
      margin: 2px;
      cursor: pointer;
      font-size: 1.5em;
      transition: background 0.2s;
    }
    .symbol.selected {
      background: white;
      color: black;
    }
    h2 {
      margin-top: 30px;
    }
    /* Raster-Layout (15 Spalten x 10 Zeilen) */
    #grid {
      display: grid;
      grid-template-columns: repeat(15, 2ch);
      gap: 1px;
      margin: 20px auto;
      width: fit-content;
    }
    .cell {
      width: 2ch;
      height: 2ch;
      border: 1px solid white;
      text-align: center;
      line-height: 2ch;
      cursor: pointer;
      transition: background 0.2s;
    }
    .cell:hover {
      background: #333;
    }
    button {
      margin: 10px 5px;
      padding: 5px 10px;
      cursor: pointer;
    }
    textarea {
      margin-top: 10px;
      width: 100%;
      max-width: 100%;
      font-family: monospace;
    }
  </style>
  <!-- html2canvas wird ben√∂tigt, um das Raster als Bitmap zu kopieren -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div id="editorContainer">
    <h1>Weltensymbol Editor</h1>
    
    <label for="worldSelect">Welt ausw√§hlen:</label>
    <select id="worldSelect">
      <!-- Optionen werden per JavaScript hinzugef√ºgt -->
    </select>
    
    <div id="symbolPalette"></div>
    
    <h2>Ausgabefeld (Grid)</h2>
    <div id="grid"></div>
    
    <button id="clearGrid">Grid leeren</button>
    <button id="copyGrid">Grid kopieren (Text)</button>
    <button id="copyBitmap">Bitmap kopieren</button>
    <button id="generateAltText">ALT Text generieren</button>
    <!-- Neuer Button: √úbergabe an die Spielseite -->
    <button id="transferToGame">In Spiel √ºbernehmen</button>
    <br>
    <textarea id="gridOutput" rows="10" readonly></textarea>
  </div>
  
  <script>
    // Definition der Welten (basierend auf Deinem Projekt)
    const worldTypes = {
      galaxy: { 
        symbols: ["üßø", "üï≥Ô∏è", "‚úÆ", "üé±", "üåç", "‚òæ", "üåå", "üåë", "ü™ê", "üåï", "‚òÑÔ∏è", "üí´", "üöÄ", "üõ∏", "üå†", "üåô", "‚≠êÔ∏è", "üåú", "üåö"],
        rare: ["üëæ", "üëΩ", "üéÆ", "üë©‚ÄçüöÄ", "üî´", "üõ∞Ô∏è"],
        bottom: ["üî≠", "üì°"]
      },
      flowers: { 
        symbols: ["üå∏", "üåπ", "üå∫", "üåª", "üåº", "üíê", "ü•Ä", "üå∑", "üçÄ"],
        rare: ["ü¶ã", "üêû", "üêù", "üçÑ", "üêá"],
        bottom: []
      },
      water: { 
        symbols: ["üê†", "üêü", "üê¨", "üê≥", "üêã", "ü¶à", "ü¶ë", "üêô", "üåä", "üö§", "‚õµ", "üö¢", "üõ•Ô∏è"],
        rare: ["üßú‚Äç‚ôÇÔ∏è", "üßú‚Äç‚ôÄÔ∏è", "üêã", "ü§ø", "ü•Ω", "üî±", "‚öì"],
        bottom: []
      },
      forest: { 
        symbols: ["üå≤", "üå≥", "üå¥", "üçÑ", "üåø", "üçÉ", "üçÇ", "ü¶â", "üêøÔ∏è", "ü¶å", "üêª", "üêá"],
        rare: ["ü¶Ö", "ü™∫"],
        bottom: []
      },
      lava: { 
        symbols: ["üî•", "üåã", "ü™®", "üíÄ", "üëπ"],
        rare: [],
        bottom: []
      },
      steampunk: { 
        symbols: ["‚öôÔ∏è", "üî©", "üõ†Ô∏è", "‚è≥", "üöÇ"],
        rare: [],
        bottom: []
      },
      desert: { 
        symbols: ["üèúÔ∏è", "üåµ", "üê´", "ü¶Ç", "‚òÄÔ∏è"],
        rare: [],
        bottom: []
      },
      medieval: { 
        symbols: ["‚öîÔ∏è", "üõ°Ô∏è", "üè∞", "üêâ", "üßô‚Äç‚ôÇÔ∏è", "üëë"],
        rare: [],
        bottom: []
      },
      racing: { 
        symbols: ["üèéÔ∏è", "üö¶", "üèÅ", "üöó"],
        rare: [],
        bottom: []
      },
      airport: { 
        symbols: ["‚úàÔ∏è", "üõ´", "üõ¨", "üõÑ"],
        rare: [],
        bottom: []
      },
      cyberpunk: { 
        symbols: ["üîÆ", "üíæ", "üï∂Ô∏è", "üõ∏", "ü§ñ"],
        rare: [],
        bottom: []
      },
      northpole: { 
        symbols: ["‚ùÑÔ∏è", "‚õÑ", "üéÖ", "ü¶å", "üèîÔ∏è"],
        rare: [],
        bottom: []
      },
      volcano: { 
        symbols: ["üåã", "üî•", "ü™®", "üíÄ"],
        rare: [],
        bottom: []
      },
      office: { 
        symbols: ["‚å®Ô∏è", "‚òï", "üñ•Ô∏è", "üìé", "üìÅ"],
        rare: [],
        bottom: []
      },
      candyland: { 
        symbols: ["üç≠", "üç´", "üç©", "üç™", "üç¨"],
        rare: [],
        bottom: []
      },
      jungle: { 
        symbols: ["üå¥", "üêí", "ü¶ú", "üçå", "üêç"],
        rare: [],
        bottom: []
      },
      circus: { 
        symbols: ["üé™", "ü§π‚Äç‚ôÇÔ∏è", "üé≠", "üêò"],
        rare: [],
        bottom: []
      },
      ruins: { 
        symbols: ["üè∫", "üóø", "‚õèÔ∏è", "üèöÔ∏è"],
        rare: [],
        bottom: []
      },
      disco: { 
        symbols: ["ü™©", "üíÉ", "üï∫", "üé∂"],
        rare: [],
        bottom: []
      },
      concert: { 
        symbols: ["üé§", "üé∏", "ü•Å", "üéµ"],
        rare: [],
        bottom: []
      },
      fairytale: {
        symbols: ["üßö", "‚ú®", "üåà"],
        rare: ["ü¶Ñ"],
        bottom: []
      },
      apocalypse: {
        symbols: ["‚ò¢Ô∏è", "üèöÔ∏è", "üî•"],
        rare: ["üí£"],
        bottom: []
      },
      cave: {
        symbols: ["ü™®", "‚õ∞Ô∏è", "üï∏Ô∏è"],
        rare: [],
        bottom: []
      },
      cloud: {
        symbols: ["‚òÅÔ∏è", "üå§Ô∏è", "üåà"],
        rare: [],
        bottom: []
      },
      arcade: {
        symbols: ["üéÆ", "üëæ", "üïπÔ∏è"],
        rare: [],
        bottom: []
      }
    };
    
    // Einstellungen f√ºr das Raster
    const gridCols = 15;
    const gridRows = 10;
    let gridData = [];
    let selectedSymbol = "";
    
    // DOM-Elemente
    const worldSelect = document.getElementById("worldSelect");
    const symbolPalette = document.getElementById("symbolPalette");
    const gridContainer = document.getElementById("grid");
    const gridOutput = document.getElementById("gridOutput");
    
    // F√ºllt das Dropdown mit den vorhandenen Welten
    function populateWorldSelect() {
      for (let world in worldTypes) {
        const option = document.createElement("option");
        option.value = world;
        option.textContent = world;
        worldSelect.appendChild(option);
      }
    }
    
    // Erzeugt die Symbol-Palette f√ºr die aktuell ausgew√§hlte Welt
    function populateSymbolPalette() {
      symbolPalette.innerHTML = "";
      const world = worldTypes[worldSelect.value];
      // Kombiniert regul√§re, rare und bottom-Symbole
      const symbols = world.symbols.concat(world.rare, world.bottom);
      symbols.forEach(sym => {
        const span = document.createElement("span");
        span.classList.add("symbol");
        span.textContent = sym;
        span.addEventListener("click", () => {
          // Alle Symbole als nicht ausgew√§hlt markieren
          document.querySelectorAll(".symbol").forEach(el => el.classList.remove("selected"));
          span.classList.add("selected");
          selectedSymbol = sym;
        });
        symbolPalette.appendChild(span);
      });
    }
    
    // Initialisiert das Raster und die zugeh√∂rigen Daten
    function initGrid() {
      gridData = [];
      gridContainer.innerHTML = "";
      for (let r = 0; r < gridRows; r++) {
        let row = [];
        for (let c = 0; c < gridCols; c++) {
          row.push(" ");
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.textContent = " ";
          cell.addEventListener("click", () => {
            if (selectedSymbol !== "") {
              cell.textContent = selectedSymbol;
              gridData[r][c] = selectedSymbol;
              updateGridOutput();
            }
          });
          gridContainer.appendChild(cell);
        }
        gridData.push(row);
      }
    }
    
    // Aktualisiert das Textfeld mit dem aktuellen Rasterinhalt
    function updateGridOutput() {
      gridOutput.value = gridData.map(row => row.join("")).join("\n");
    }
    
    // L√∂scht das Raster
    function clearGrid() {
      gridData = gridData.map(row => row.map(() => " "));
      Array.from(gridContainer.children).forEach(cell => cell.textContent = " ");
      updateGridOutput();
    }
    
    // Kopiert den Rasterinhalt als Text in den Zwischenspeicher
    function copyGridToClipboard() {
      navigator.clipboard.writeText(gridOutput.value)
        .then(() => alert("Grid kopiert!"))
        .catch(err => alert("Fehler beim Kopieren: " + err));
    }
    
    // Kopiert das Raster (Grid) als Bitmap in den Zwischenspeicher
    function copyGridAsBitmap() {
      if (!navigator.clipboard || !navigator.clipboard.write) {
        alert("Das Kopieren von Bitmaps wird auf diesem Ger√§t nicht unterst√ºtzt.");
        return;
      }
      html2canvas(gridContainer).then(canvas => {
        canvas.toBlob(blob => {
          const item = new ClipboardItem({ "image/png": blob });
          navigator.clipboard.write([item]).then(() => {
            alert("Bitmap kopiert!");
          }).catch(err => {
            console.error("Fehler beim Kopieren: ", err);
            alert("Fehler beim Kopieren der Bitmap.");
          });
        });
      });
    }
    
    // Generiert einen ALT-Text basierend auf der aktuell ausgew√§hlten Welt
    function generateAltText() {
      const worldDescriptions = {
        galaxy: "galaktische",
        flowers: "blumige",
        water: "wasserbasierte",
        forest: "waldartige",
        lava: "feurige",
        steampunk: "steampunk",
        desert: "w√ºstenartige",
        medieval: "mittelalterliche",
        racing: "rennbegeisterte",
        airport: "flughafenbezogene",
        cyberpunk: "cyberpunk",
        northpole: "nordpolartige",
        volcano: "vulkanische",
        office: "b√ºrokratische",
        candyland: "s√º√üe",
        jungle: "dschungelartige",
        circus: "zirkusartige",
        ruins: "ruin√∂se",
        disco: "discoartige",
        concert: "konzertbezogene",
        fairytale: "m√§rchenhafte",
        apocalypse: "apokalyptische",
        cave: "h√∂llische",
        cloud: "himmelhafte",
        arcade: "retro-arcade"
      };
      const worldType = worldSelect.value;
      const description = worldDescriptions[worldType] || worldType;
      let altText = "Alternativtext: Dieses Bild zeigt eine " + description + " Welt, erstellt mit dem Weltensymbol Editor. Das Raster hat " + gridRows + " Zeilen und " + gridCols + " Spalten.";
      navigator.clipboard.writeText(altText).then(() => {
        alert("ALT Text kopiert!");
      }).catch(err => {
        console.error("Fehler beim Kopieren des ALT Texts: ", err);
      });
    }
    
    // √úbergibt das aktuelle Grid und die genutzte Welt als URL-Parameter an die Hauptseite (Spiel)
function transferToGame() {
  const world = worldSelect.value;
  const grid = gridOutput.value;
  const params = new URLSearchParams();
  params.set("world", world);
  params.set("grid", grid);
  // URLSearchParams kodiert die Werte automatisch (z.‚ÄØB. Zeilenumbr√ºche werden zu %0A)
  window.location.href = "Weltengenerator_Mit_Spiel.html?" + params.toString();
}

    
    // Falls der Editor √ºber Parameter (von der Hauptseite) aufgerufen wurde: Raster und Welt setzen
function loadEditorFromParams() {
  const params = new URLSearchParams(window.location.search);
  if (params.has("world") && params.has("grid")) {
    const world = params.get("world");
    const gridText = params.get("grid");
    worldSelect.value = world;
    populateSymbolPalette();
    const rows = gridText.split("\n");
    gridData = rows.map(row => {
      let arr = Array.from(row);
      // Passe die L√§nge der Zeile an die erwartete Spaltenzahl im Editor an:
      if (arr.length < gridCols) {
        arr = arr.concat(Array(gridCols - arr.length).fill(" "));
      } else if (arr.length > gridCols) {
        arr = arr.slice(0, gridCols);
      }
      return arr;
    });
    // Aktualisiere die einzelnen Zellen im DOM:
    const cells = gridContainer.querySelectorAll(".cell");
    for (let r = 0; r < gridRows; r++) {
      for (let c = 0; c < gridCols; c++) {
        const index = r * gridCols + c;
        if (cells[index]) {
          cells[index].textContent = gridData[r][c] || " ";
        }
      }
    }
    updateGridOutput();
  }
}



    
    // Event Listener
    worldSelect.addEventListener("change", populateSymbolPalette);
    document.getElementById("clearGrid").addEventListener("click", clearGrid);
    document.getElementById("copyGrid").addEventListener("click", copyGridToClipboard);
    document.getElementById("copyBitmap").addEventListener("click", copyGridAsBitmap);
    document.getElementById("generateAltText").addEventListener("click", generateAltText);
    document.getElementById("transferToGame").addEventListener("click", transferToGame);
    
    // Initialisierung
    populateWorldSelect();
    populateSymbolPalette();
    initGrid();
    updateGridOutput();
    loadEditorFromParams();
  </script>
</body>
</html>
