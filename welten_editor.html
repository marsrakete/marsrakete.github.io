<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Weltensymbol Editor</title>
  <style>
    body {
      background: #121212;
      color: white;
      font-family: monospace;
      padding: 20px;
      text-align: center;
    }
    #editorContainer {
      max-width: 800px;
      margin: auto;
    }
    select {
      font-size: 1em;
      padding: 5px;
    }
    #symbolPalette {
      margin-top: 20px;
    }
    .symbol {
      display: inline-block;
      padding: 5px;
      border: 1px solid white;
      margin: 2px;
      cursor: pointer;
      font-size: 1.5em;
      transition: background 0.2s;
    }
    .symbol.selected {
      background: white;
      color: black;
    }
    h2 {
      margin-top: 30px;
    }
    /* Das Grid wird als CSS-Grid angezeigt */
    #output {
      display: grid;
      grid-template-columns: repeat(15, 2ch);
      gap: 1px;
      width: 60ch;
      height: 15em;
      background: black;
      padding: 10px;
      border: 1px solid white;
      margin: 10px auto;
      overflow: hidden;
      font-size: 2em;
      line-height: 1.2em;
    }
    /* Die Textarea erh√§lt dieselben Ma√üe */
    #gridOutput {
      width: 60ch;
      height: 15em;
      background: black;
      color: white;
      padding: 10px;
      border: 1px solid white;
      margin-top: 10px;
      font-family: monospace;
      font-size: 2em;
      line-height: 1.2em;
      overflow: hidden;
      resize: none;
    }
    .cell {
      width: 2ch;
      height: 2ch;
      text-align: center;
      line-height: 2ch;
      border: 1px solid white;
      cursor: pointer;
      transition: background 0.2s;
    }
    .cell:hover {
      background: #333;
    }
    button {
      margin: 10px 5px;
      padding: 5px 10px;
      cursor: pointer;
    }
  </style>
  <!-- html2canvas wird ben√∂tigt -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div id="editorContainer">
    <h1>Weltensymbol Editor</h1>
    <label for="worldSelect">Welt ausw√§hlen:</label>
    <select id="worldSelect"></select>
    <div id="symbolPalette"></div>
    
    <h2>Ausgabefeld</h2>
    <!-- Visuelles Grid -->
    <div id="output"></div>
    <!-- Textarea zeigt das Grid als Text -->
    <textarea id="gridOutput" readonly></textarea>
    <br>
    <button id="clearGrid">Grid leeren</button>
    <button id="copyGrid">Grid kopieren (Text)</button>
    <button id="copyBitmap">Bitmap kopieren</button>
    <button id="generateAltText">ALT Text generieren</button>
    <button id="transferToGame">In Spiel √ºbernehmen</button>
  </div>
  
  <script>
    const gridCols = 15;
    const gridRows = 10;
    let gridData = [];
    let selectedSymbol = "";
    
    // worldTypes gem√§√ü dem von dir vorgegebenen Snippet:
    const worldTypes = {
      galaxy: { 
        symbols: ["üßø","üï≥Ô∏è","‚úÆ","üé±","üåç","‚òæ","üåå","üåë","ü™ê","üåï","‚òÑÔ∏è","üí´","üöÄ","üõ∏","üå†","üåô","‚≠êÔ∏è","üåú","üåö"],
        rare: ["üëæ","üëΩ","üéÆ","üë©‚ÄçüöÄ","üî´","üõ∞Ô∏è"],
        bottom: ["üî≠","üì°"]
      },
      flowers: { 
        symbols: ["üå∏","üåπ","üå∫","üåª","üåº","üíê","ü•Ä","üå∑","üçÄ"],
        rare: ["ü¶ã","üêû","üêù","üçÑ","üêá","üçÑ‚Äçüü´","üçÑ","ü™∞","ü™Å"],
        bottom: []
      },
      water: { 
        symbols: ["üê†","üêü","üê¨","üê≥","üêã","ü¶à","ü¶ë","üêô","üåä","üö§","‚õµ","üö¢","üõ•Ô∏è"],
        rare: ["üßú‚Äç‚ôÇÔ∏è","üßú‚Äç‚ôÄÔ∏è","üêã","ü§ø","ü•Ω","üî±","‚öì","ü¶à","üõü","ü©≥","üèä‚Äç‚ôÄÔ∏è","üèä‚Äç‚ôÇÔ∏è","üèä","üèÑ","ü§Ω‚Äç‚ôÇÔ∏è"],
        bottom: []
      },
      forest: { 
        symbols: ["üå≤","üå≥","üå¥","üçÑ","üåø","üçÉ","üçÇ","ü¶â","üêøÔ∏è","ü¶å","üêª","üêá"],
        rare: ["ü¶Ö","ü™∫","ü™π"],
        bottom: []
      },
      lava: { 
        symbols: ["üî•","üåã","ü™®","üíÄ","üëπ","‚öîÔ∏è","‚ô®Ô∏è"],
        rare: [],
        bottom: []
      },
      steampunk: { 
        symbols: ["‚öôÔ∏è","üî©","üõ†Ô∏è","‚è≥","üöÇ","üé©","üï∞Ô∏è","üîß","üß∞"],
        rare: [],
        bottom: []
      },
      desert: { 
        symbols: ["üèúÔ∏è","üåµ","üê´","ü¶Ç","‚òÄÔ∏è","üåû","üêç","ü¶é"],
        rare: [],
        bottom: []
      },
      medieval: { 
        symbols: ["‚öîÔ∏è","üõ°Ô∏è","üè∞","üêâ","üßô‚Äç‚ôÇÔ∏è","üëë","üèπ","üó°Ô∏è","üìú"],
        rare: [],
        bottom: []
      },
      racing: { 
        symbols: ["üèéÔ∏è","üö¶","üõ£Ô∏è","üèÅ","üöó","üí®","üöò","‚õΩ"],
        rare: [],
        bottom: []
      },
      airport: { 
        symbols: ["‚úàÔ∏è","üõ´","üõ¨","üõÑ","üé´","üõ©Ô∏è","üöÅ"],
        rare: [],
        bottom: []
      },
      cyberpunk: { 
        symbols: ["üîÆ","üíæ","üï∂Ô∏è","üõ∏","ü§ñ","‚ö°","üéõÔ∏è","üñ•Ô∏è","üí°","üì°"],
        rare: [],
        bottom: []
      },
      northpole: { 
        symbols: ["‚ùÑÔ∏è","‚õÑ","üéÖ","ü¶å","üèîÔ∏è","üå®Ô∏è","üéÅ","üõ∑","üå≤"],
        rare: [],
        bottom: []
      },
      volcano: { 
        symbols: ["üåã","üî•","ü™®","üíÄ","‚õèÔ∏è","üå™Ô∏è","‚ô®Ô∏è","üöí"],
        rare: [],
        bottom: []
      },
      office: { 
        symbols: ["‚å®Ô∏è","‚òï","üñ•Ô∏è","üìé","üìÅ","üñ®Ô∏è","üìä","üìÖ","üñãÔ∏è","üìû","üíª","üì†"],
        rare: ["üñáÔ∏è","üóÉÔ∏è","üè¢","üóÇÔ∏è","üßë‚Äçüíº","üë©‚Äçüíº"],
        bottom: []
      },
      candyland: { 
        symbols: ["üç≠","üç´","üç©","üç™","üç¨","üç∞","üéÇ","üçß","üç¶"],
        rare: ["üç®","üßÅ","üç†","üßá"],
        bottom: []
      },
      jungle: { 
        symbols: ["üå¥","üêí","ü¶ú","üçå","üêç","üêÖ","üêÜ","ü¶Å","üêò"],
        rare: [],
        bottom: []
      },
      circus: { 
        symbols: ["üé™","ü§π‚Äç‚ôÇÔ∏è","üé≠","üêò","üé†","ü§°","üéüÔ∏è","üé´"],
        rare: [],
        bottom: []
      },
      ruins: { 
        symbols: ["üè∫","üóø","‚õèÔ∏è","üèõÔ∏è","üî¶","üèöÔ∏è","üó∫Ô∏è"],
        rare: [],
        bottom: []
      },
      disco: { 
        symbols: ["ü™©","üíÉ","üï∫","üé∂","üîä","üåà","üéß","üíø"],
        rare: [],
        bottom: []
      },
      concert: { 
        symbols: ["üé§","üé∏","ü•Å","üéµ","üéß","üéπ","üé∫","üé∑"],
        rare: [],
        bottom: []
      },
      // Neue Welten:
      fairytale: {
        symbols: ["üßö","‚ú®","üåà"],
        rare: ["ü¶Ñ","üîÆ","ü™Ñ"],
        bottom: []
      },
      apocalypse: {
        symbols: ["‚ò¢Ô∏è","üèöÔ∏è","üî•"],
        rare: ["üí£","üåÖ"],
        bottom: []
      },
      cave: {
        symbols: ["ü™®","‚õ∞Ô∏è","üï∏Ô∏è"],
        rare: ["üè∫","üïØÔ∏è"],
        bottom: []
      },
      cloud: {
        symbols: ["‚òÅÔ∏è","üå§Ô∏è","üåà"],
        rare: ["üïäÔ∏è","ü¶ã"],
        bottom: []
      },
      arcade: {
        symbols: ["üéÆ","üëæ","üïπÔ∏è"],
        rare: ["‚≠êÔ∏è","üíé"],
        bottom: []
      }
    };
    
    // Spiel-Einstellungen gem√§√ü index.html:
    const gameSettings = {
      galaxy:    { player: "üöÄ", target: "üåç" },
      water:     { player: "üèä‚Äç‚ôÇÔ∏è", target: "üêã" },
      flowers:   { player: "üêù", target: "üåπ" },
      forest:    { player: "ü¶ä", target: "üçÑ" },
      lava:      { player: "üòé", target: "üî•" },
      steampunk: { player: "ü§ñ", target: "‚öôÔ∏è" },
      desert:    { player: "üê´", target: "üåµ" },
      medieval:  { player: "üßô‚Äç‚ôÇÔ∏è", target: "üëë" },
      racing:    { player: "üèéÔ∏è", target: "üö¶" },
      airport:   { player: "‚úàÔ∏è", target: "üõ´" },
      cyberpunk: { player: "ü§ñ", target: "üíæ" },
      northpole: { player: "‚õÑ", target: "‚ùÑÔ∏è" },
      volcano:   { player: "üöí", target: "üåã" },
      office:    { player: "üë©‚Äçüíº", target: "üìé" },
      candyland: { player: "üç≠", target: "üç¨" },
      jungle:    { player: "üêí", target: "üçå" },
      circus:    { player: "ü§π‚Äç‚ôÇÔ∏è", target: "üé™" },
      ruins:     { player: "üè∫", target: "üóø" },
      disco:     { player: "üï∫", target: "üíÉ" },
      concert:   { player: "üé§", target: "üé∏" },
      pirate:    { player: "üè¥‚Äç‚ò†Ô∏è", target: "‚ò†Ô∏è" },
      ghost:     { player: "üëª", target: "üéÉ" },
      party:     { player: "ü•≥", target: "üéâ" },
      fairytale: { player: "üßö‚Äç‚ôÄÔ∏è", target: "ü¶Ñ" },
      apocalypse:{ player: "üò∑", target: "üåÖ" },
      cave:      { player: "‚õèÔ∏è", target: "üè∫" },
      cloud:     { player: "‚òÅÔ∏è", target: "üïäÔ∏è" },
      arcade:    { player: "üéÆ", target: "üíé" }
    };
    
    function populateWorldSelect() {
      const worldSelect = document.getElementById("worldSelect");
      worldSelect.innerHTML = "";
      for (let world in worldTypes) {
        const option = document.createElement("option");
        option.value = world;
        option.textContent = world;
        worldSelect.appendChild(option);
      }
    }
    
    function populateSymbolPalette() {
      const palette = document.getElementById("symbolPalette");
      palette.innerHTML = "";
      const world = worldTypes[document.getElementById("worldSelect").value];
      const symbols = world.symbols.concat(world.rare, world.bottom);
      symbols.forEach(sym => {
        const span = document.createElement("span");
        span.classList.add("symbol");
        span.textContent = sym;
        span.addEventListener("click", () => {
          document.querySelectorAll(".symbol").forEach(el => el.classList.remove("selected"));
          span.classList.add("selected");
          selectedSymbol = sym;
        });
        palette.appendChild(span);
      });
    }
    
    function initGrid() {
      gridData = [];
      const output = document.getElementById("output");
      output.innerHTML = "";
      for (let r = 0; r < gridRows; r++) {
        let row = [];
        for (let c = 0; c < gridCols; c++) {
          row.push(" ");
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.textContent = " ";
          cell.addEventListener("click", () => {
            if (selectedSymbol !== "") {
              cell.textContent = selectedSymbol;
              gridData[r][c] = selectedSymbol;
              updateGridOutput();
            }
          });
          output.appendChild(cell);
        }
        gridData.push(row);
      }
      updateGridOutput();
    }
    
    function updateGridOutput() {
      const textArea = document.getElementById("gridOutput");
      textArea.value = gridData.map(row => row.join("")).join("\n");
    }
    
    function clearGrid() {
      gridData = gridData.map(row => row.map(() => " "));
      document.querySelectorAll("#output .cell").forEach(cell => cell.textContent = " ");
      updateGridOutput();
    }
    
    function copyGridToClipboard() {
      navigator.clipboard.writeText(document.getElementById("gridOutput").value)
        .then(() => alert("Grid kopiert!"))
        .catch(err => alert("Fehler beim Kopieren: " + err));
    }
    
    function copyGridAsBitmap() {
      if (!navigator.clipboard || !navigator.clipboard.write) {
        alert("Das Kopieren von Bitmaps wird auf diesem Ger√§t nicht unterst√ºtzt.");
        return;
      }
      html2canvas(document.getElementById("gridOutput")).then(canvas => {
        canvas.toBlob(blob => {
          const item = new ClipboardItem({ "image/png": blob });
          navigator.clipboard.write([item]).then(() => {
            alert("Bitmap kopiert!");
          }).catch(err => {
            console.error("Fehler beim Kopieren: ", err);
            alert("Fehler beim Kopieren der Bitmap.");
          });
        });
      });
    }
    
function generateAltText() {
  // Hole die aktuell ausgew√§hlte Welt aus worldData
  const currentWorldKey = document.getElementById("worldSelect").value;
  const currentWorld = worldData[currentWorldKey];
  
  // Verwende die Beschreibung, sofern vorhanden ‚Äì ansonsten falls nicht definiert, den worlds key
  const description = currentWorld.description || currentWorldKey;
  
  // Erzeuge den ALT-Text, der nun die in worldData definierte Description beinhaltet
  let altText = "Alternativtext: Dieses Bild zeigt eine " + description + " Welt, erstellt mit dem Weltensymbol Editor. ";
  altText += "Das Raster hat " + gridRows + " Zeilen und " + gridCols + " Spalten.";
  
  navigator.clipboard.writeText(altText)
    .then(() => alert("ALT Text kopiert!"))
    .catch(err => alert("Fehler beim Kopieren des ALT Texts: " + err));
}

    function transferToGame() {
      const currentWorld = document.getElementById("worldSelect").value;
      const currentGame = gameSettings[currentWorld] || { player: "üôÇ", target: "‚≠êÔ∏è" };
      const flatGrid = gridData.flat();
      let errors = [];
      if (!flatGrid.includes(currentGame.player)) {
        errors.push("Das Spielersymbol (" + currentGame.player + ") fehlt.");
      }
      if (!flatGrid.includes(currentGame.target)) {
        errors.push("Das Zielsymbol (" + currentGame.target + ") fehlt.");
      }
      if (errors.length > 0) {
        alert("Fehler: " + errors.join(" "));
        return;
      }
      const params = new URLSearchParams();
      params.set("world", currentWorld);
      const gridText = gridData.map(row => row.join("")).join("\n");
      params.set("grid", gridText);
      window.location.href = "Weltengenerator_Mit_Spiel.html?" + params.toString();
    }
    
    document.getElementById("worldSelect").addEventListener("change", populateSymbolPalette);
    document.getElementById("clearGrid").addEventListener("click", clearGrid);
    document.getElementById("copyGrid").addEventListener("click", copyGridToClipboard);
    document.getElementById("copyBitmap").addEventListener("click", copyGridAsBitmap);
    document.getElementById("generateAltText").addEventListener("click", generateAltText);
    document.getElementById("transferToGame").addEventListener("click", transferToGame);
    
    window.addEventListener("load", () => {
      populateWorldSelect();
      populateSymbolPalette();
      initGrid();
    });
  </script>
</body>
</html>
